---
title: "ML4ECON - Final Project"
author: "Yonatan Schoen"
date: "`r Sys.Date()`"
output: html_document
theme: journal
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(stargazer)
```

# Introduction

This markdown contains both code and text for the final project in the ML4Econ course in HUJI, class of 2023.
The paper I chose for the project is *US Food Aid and Civil Conflict*,by Nathan Nunn and Nancy Qian (2014). 

This project have two purposes :
1. Replicate the main results from Nunn & Qian (2014) paper
2. Extend the analysis with methods learned in the course, for example - using Lasso to choose variables, causal trees, etc.

We begin by loading relevant packages, setting a table format and loading the dataset.

```{r setup , message= FALSE, warning=FALSE}
if (!require("pacman")) install.packages("pacman")
  pacman::p_load(
    haven,
    vtable,
    tidyverse,
    magrittr,
    fastDummies,
    stargazer,
    kableExtra,
    flextable,
    officer,
    stringr,
    hdm,
    AER,
    tidymodels,
    glmnet,
    xgboost,
    vip,
    broom,      
    rpart,       
    rpart.plot,  
    ranger,
    rsample,
    knitr,       
    rattle,
    caret,
    doParallel,
    tinytex
    )
  
 #set the latex alike tables format 
table_format <- function(x) {
    kbl(x = x,booktabs = T, digits = 1, caption = NULL, position = "center") %>%
    add_header_above(c(" ", "Parsimonious specifications" = 4, "Baseline specification" = 3)) %>%
    kable_styling(latex_options = c("repeat_header")) %>% 
    kable_classic_2(lightable_options = c("bordered", "hover"), full_width = F, html_font = "Cambria",position = position)
}

#Load the data
data <- read_dta("in_sample.dta")

```

# Nunn, Nathan, and Nancy Qian (2014) - Background

???

# Nunn, Nathan, and Nancy Qian (2014) - Data, result and replication

## Data Preperation 
```{r}

# Control groups for the different specifications
US_controls <-  "oil_fadum_avg + US_income_fadum_avg + US_democ_pres_fadum_avg"
weather_controls <- "all_Precip_jan-all_Precip_dec + all_Temp_jan-all_Temp_dec + all_Precip_jan_faavg-all_Precip_dec_faavg + all_Temp_jan_faavg-all_Temp_dec_faavg"
country_chars_controls <- "gdp_y2-gdp_y36 + usmil_y2-usmil_y36 + usec_y2-usec_y36"
cereals_controls <- "rcereal_y2-rcereal_y36 + rimport_y2-rimport_y36"
baseline_controls <- "oil_fadum_avg + US_income_fadum_avg + US_democ_pres_fadum_avg + gdp_y2-gdp_y36 + usmil_y2-usmil_y36 + usec_y2-usec_y36 + rcereal_y2-rcereal_y36 + rimport_y2-rimport_y36 + all_Precip_jan-all_Precip_dec + all_Temp_jan-all_Temp_dec + all_Precip_jan_faavg-all_Precip_dec_faavg + all_Temp_jan_faavg-all_Temp_dec_faavg"

#

```

I shall start by replicating the descriptive statistics summary table. Similar table can be found in the paper(Table 1).
This table summarize the probability of different kinds of conflict to embark, amount of US wheat aid received,  frequency of receiving and US food aid (Yearly,during 1971-2006), the lagged US wheat production (the instrument variable), and the local production of wheat and other cereals in the recipient country in the following year.

## Descriptive Statistics Replication
```{r, results='asis'}
sum_tab <- data %>%
  filter(in_sample == 1) %>%
  select(any_war, intra_state, inter_state, wheat_aid, fadum_avg, instrument2, recipient_cereals_prod, recipient_wheat_prod)

var.labs <- data.frame(
              var = c('any_war', 'intra_state', 'inter_state', 'wheat_aid', 'fadum_avg', 'instrument2', 'recipient_cereals_prod', 'recipient_wheat_prod'), 
              labels = c('Any conflict','Intrastate conflict',"Onset of intrastate conflict (all observations)", "US wheat aid (1,000 MT)","Frequency of receiving any US food aid", "Lagged US wheat production (1,000 MT)", "Recipient country cereals production", "Recipient country wheat production"))

sumtable(sum_tab, title = "Summary Statistics", labels = var.labs ,digits = 3, summ = c('notNA(x)','mean(x)','sd(x)'), summ.names = c('Observations', 'Mean', 'SD'), col.align = 'center', note = "Observation is specific country in specific year. Some variables from the original table has been omitted due to irelevancy for our replication.")
```


## Main Results Replication

# ML Extension

## IV estimation with Lasso-based first stage

# Prediction
